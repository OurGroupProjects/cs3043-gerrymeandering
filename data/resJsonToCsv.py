import sys
import json
import csv
from pprint import pprint

json_file_in = 'res/districtsData.json'
csv_file_out = 'res/districtsData.csv'

columns = [
    'state',
    'start_cong',
    'end_cong',
    'start_cong_dates',
    'end_cong_dates',
    'district_num',
    'area',
    'perimeter',
    'max_from_center',
]

cong_date_map = {
1:[1789,1790],2:[1791,1792],3:[1793,1794],4:[1795,1796],5:[1797,1798],6:[1799,1800],7:[1801,1802],8:[1803,1804],9:[1805,1806],10:[1807,1808],
11:[1809,1810],12:[1811,1812],13:[1813,1814],14:[1815,1816],15:[1817,1818],16:[1819,1820],17:[1821,1822],18:[1823,1824],19:[1825,1826],20:[1827,1828],
21:[1829,1830],22:[1831,1832],23:[1833,1834],24:[1835,1836],25:[1837,1838],26:[1839,1840],27:[1841,1842],28:[1843,1844],29:[1845,1846],30:[1847,1848],
31:[1849,1850],32:[1851,1852],33:[1853,1854],34:[1855,1856],35:[1857,1858],36:[1859,1860],37:[1861,1862],38:[1863,1864],39:[1865,1866],40:[1867,1868],
41:[1869,1870],42:[1871,1872],43:[1873,1874],44:[1875,1876],45:[1877,1878],46:[1879,1880],47:[1881,1882],48:[1883,1884],49:[1885,1886],50:[1887,1888],
51:[1889,1890],52:[1891,1892],53:[1893,1894],54:[1895,1896],55:[1897,1898],56:[1899,1900],57:[1901,1902],58:[1903,1904],59:[1905,1906],60:[1907,1908],
61:[1909,1910],62:[1911,1912],63:[1913,1914],64:[1915,1916],65:[1917,1918],66:[1919,1920],67:[1921,1922],68:[1923,1924],69:[1925,1926],70:[1927,1928],
71:[1929,1930],72:[1931,1932],73:[1933,1934],74:[1935,1936],75:[1937,1938],76:[1939,1940],77:[1941,1942],78:[1943,1944],79:[1945,1946],80:[1947,1948],
81:[1949,1950],82:[1951,1952],83:[1953,1954],84:[1955,1956],85:[1957,1958],86:[1959,1960],87:[1961,1962],88:[1963,1964],89:[1965,1966],90:[1967,1968],
91:[1969,1970],92:[1971,1972],93:[1973,1974],94:[1975,1976],95:[1977,1978],96:[1979,1980],97:[1981,1982],98:[1983,1984],99:[1985,1986],100:[1987,1988],
101:[1989,1990],102:[1991,1992],103:[1993,1994],104:[1995,1996],105:[1997,1998],106:[1999,2000],107:[2001,2002],108:[2003,2004],109:[2005,2006],110:[2007,2008],
111:[2009,2010],112:[2011,2012],113:[2013,2014],114:[2015,2016],115:[2017,2018],116:[2019,2020],}

with open(csv_file_out, 'w+', newline='') as fout:
    csv_out = csv.writer(fout)
    csv_out.writerow(columns)
    with open(json_file_in) as fin:
        json_data = json.loads(fin.read())

    for congress in json_data:
        for district in congress:
            row = [
                district['properties']['STATENAME'], # State
                district['properties']['STARTCONG'], # Start/end congress
                district['properties']['ENDCONG'],
                cong_date_map[int(district['properties']['STARTCONG'])][0], # Dates
                cong_date_map[int(district['properties']['ENDCONG'])][1],
                district['properties']['DISTRICT'],  # District number
                district['computedStats']['area'],   # Computed vals
                district['computedStats']['perimeter'],
                district['computedStats']['maxFromCenter'],
            ]
            csv_out.writerow(row)
